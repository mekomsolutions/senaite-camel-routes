<routes
    xmlns="http://camel.apache.org/schema/spring">
    <route id="create-serviceRequestTask-toOpenmrs" errorHandlerRef="watcherErrorHandler">
        <from uri="direct:create-serviceRequestTask-toOpenmrs"/>
        
        <log message="Processing FHIR Task creation for order: " />
        
        <to uri="direct:authenticate-toOpenmrs"/>
                                
        <setHeader name="CamelHttpMethod">
            <constant>POST</constant>
        </setHeader>
        
        <setBody>
            <simple>{"resourceType": "Task", "status": "requested", "intent": "order", "basedOn": [{"reference":"${exchangeProperty.lab-order-uuid}", "type": "ServiceRequest"}]}</simple>
        </setBody>
        
        <toD cacheSize="-1" uri="{{openmrs.baseUrl}}/ws/fhir2/R4/Task"/>
        <log message="FHIR Task posted results             :          ${body}"/>
    </route>
</routes>
